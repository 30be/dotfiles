#!/usr/bin/env bash
set -euo pipefail

if [ ! $# -eq 1 ]; then
  echo 'mksh takes one argument' 1>&2
  exit 1
fi

TARGET=$HOME/bin/$1

if [ -e $TARGET ]; then
  echo "$TARGET already exists" 1>&2
  exit 1
fi

CONTENT='#!/usr/bin/env bash
set -euo pipefail

'
echo "$CONTENT" >"$TARGET"

chmod u+x "$TARGET"

"$EDITOR" "$TARGET"

if cmp -s <(echo "$CONTENT") "$TARGET"; then
  echo "File unchanged."
  rm -f "$TARGET"
else
  chezmoi add "$TARGET"
fi
